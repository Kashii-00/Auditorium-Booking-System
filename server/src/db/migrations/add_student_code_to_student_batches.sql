-- ================================================\n-- Add student_code to student_batches table\n-- ================================================\n-- This migration adds a student_code column to track \n-- which student code was assigned when student joined this batch\n-- ================================================\n\n-- Step 1: Add student_code column to student_batches table\nALTER TABLE student_batches \nADD COLUMN student_code VARCHAR(50) NULL \nAFTER batch_id;\n\n-- Step 2: Add index for performance\nALTER TABLE student_batches \nADD INDEX idx_student_batches_student_code (student_code);\n\n-- Step 3: Add comment for clarity\nALTER TABLE student_batches \nMODIFY COLUMN student_code VARCHAR(50) NULL \nCOMMENT 'Student code assigned when student joined this batch (e.g., MP-PST25.1-001)';\n\n-- Step 4: Populate existing records (if any)\n-- This will be NULL for existing records until students are re-assigned to batches\nUPDATE student_batches sb\nINNER JOIN student_courses sc ON sb.student_id = sc.student_id\nINNER JOIN batches b ON sb.batch_id = b.id AND b.course_id = sc.course_id\nSET sb.student_code = sc.student_code\nWHERE sc.student_code IS NOT NULL;\n\nSELECT 'Migration completed: Added student_code column to student_batches table' as Status; 